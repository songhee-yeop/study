# 11 보안
- 보안을 향상시키면성능 비용 사용자 경험 측면에서는 손해

## 11.1 보안 설정 적용하기
- 인증(누구), 인가(무엇을), 암호화, 감사(무엇을 했는지 하려했는지), 쿼터(자원 얼마나 많이 사용했는지 조절)
- 안전한 카프카 클러스터
  - 클라잉너트 진정성
  - 서버 진정성
  - 기밀성
  - 무결성
  - 접근 제어
  - 감사 가능성
  - 가용성

## 11.2 보안 프로토콜
- SSL: 서버와 클라이언트 사이의 인증 뿐만 아니라 암호화도 지어ㅜㄴ
- SASL: 연결 지향 프로토콜에서 서로 다른 메커니즘을 사용한 인증을 지원하는 프레임워크
- PLAINTEXT, SSL, SASL_PLAINTEXT, SASL_SSL 조합해서 정의된다.

## 11.3 인증
### 11.3.1 SSL
- TLS 설정하기
- 고려사항
  - 카프카는 기본적으로 TLSv1.2와 TLSv1.3이후의 프로토콜만 지원

### 11.3.2 SASL
- SASL/GSSAPI
  - 케르베로스는 널리 사용되는 네트워크 인증 프로토콜
  - 카프카는 SASL/GSSAPI를 통해서 케르베로스 인증 지원
- SASL/PLAIN
  - 카프카는 커스텀 콜백 핸들러를 사용해서 안전한 외부 비밀번호 저장소와 통합할 수 있는 안전한 SASL/PLAIN 구현체를 기본적으로 지원
- SASL/SCRAM
  - SCRAM은 암호화되지 않은 비밀번호가 전송되는 것을 피하고 악의적인 사용자가 다른 사용자로 가장해서 내용을 읽어오는것이 불가능한 형식으로 저장
  - SCRAM-SHA-256, SCRAM-SHA-512 두개의 SCRA 메커니즘 지원
- SASL/OAUTHBEARER
  - OAuth는 애플리케이션이 HTTP 서비스에 대해 제한된 접근 권한을 획득할 수 있는 인가 프레임워크
- 위임 토큰
  - 카프카 브로커와 클라이언트 사이에 공유된 비밀로서 클라이언트에 SSL 키스토어나 케르베로스 키탭 파일을 배포할 필요가 없는 경량 설정 메커니즘 제
  - 위임토컨은 안전한 주키퍼를 사용해서 동작하고 있는 프로덕션 환경에서만 적당하다

### 11.3.3 재인증

### 11.3.4 무중단 보안 업데이트

## 11.4 암호화

### 11.4.1 종단 암호화
- 직렬화도중에 메시지 암호화하거나 역직렬화 도중 복호화
- AES 사용
- 종단 암호화상황에서 카프카의 데이터 흐름
  - 1. 카프카 프로듀서를 사용해서 메시지 보냄
  - 2. 프로듀서가 KMS에 저장된 암호화 키를 사용해서 메시지 암호화
  - 3. 암호화된 메시지가 브로커로 전달. 브로커는 암호화된 메시지를 파티션 로그에 저장
  - 4. 브로커가 암호화된 메시지를 컨슈머로 보냄
  - 5. 컨슈머가 KMS에 저장된 암호화 키를 사용해서 메시지를 복호화

## 11.5 인가

### 11.5.1 AclAuthorizer
- 접근 제어 목록을 사용해서 카프카 자우너에 대한 접근을 세밀하게 제어할 수 있도록 해줌
- ACL은 주키퍼에 저장.(브로커의 메모리에 캐시)

### 11.5.2 인가 기능 커스터마이즈하기

## 11.6 감사
- log4j 로그를 생성하도록 카프카 브로커 설정 가능

## 11.7 주키퍼 보안
- 주키퍼에도 보안 조치를 취하는 것이 필수적

## 11.8 플랫폼 보안
- 카프카는 외부의 안전한 저장소에 비밀번호를 저장할 수 있도록 한다.

### 11.8.1 비밀번호 보호
