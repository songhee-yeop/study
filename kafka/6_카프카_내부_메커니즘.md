# 6. 카프카 내부 메커니즘
- 트러블 슈팅이나 실행 방식에 도움 됨

## 6.1 클러스터 멤버쉽
- 브로커 프로세스는 시작될 때마다 주키퍼에 Ephemeral 노드의 형태로 ID 등록
  - 동일한 id가 들어오면 에러
### 6.2.1 KRaft
- 주키퍼 기반 컨트롤러부터 탈피해서 래프트 기반 컨트롤러 쿼럼으로 옮겨가는 프로젝트.(3.3부터 정식 서비스)

## 6.3 복제
- 카프카에 저장되는 데이터는 토픽을 단위로 해서 조직화
- 하나의 브로커는 수백개에서 수천개의 레플리카 저장
    - 리더 레플리카
      - 모든 쓰기 요청은 여기로 주어짐
    - 팔로워 레플리카
      - 최근 메시지 복제함으로써 최신 상태 유지
## 6.5 물리적 저장소
- 기본 저장 단위는 파티션 레프리카

### 6.5.8 삭제된 이벤트
- 특정 키를 갖는 모든 메시지를 삭제하고 시픙 ㄹ때에는 해당 키값과 null밸류갑을 갖는 메시지 써줌
  - 압착 후 null 밸류 갖는 메시지만 보존

### 6.5.9 토픽은 언제 압착되는가?
- 50%이상이 더티 레코드인 경우
- 압착 시점 조정 가능